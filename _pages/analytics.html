---
layout: archive
title: "Website Analytics"
permalink: /analytics/
author_profile: true
---

<div class="analytics-dashboard">
  <div class="chart-container">
    <h2>Visitors Over Time</h2>
    <canvas id="visitorsChart"></canvas>
  </div>
  
  <div class="chart-container">
    <h2>Popular Pages</h2>
    <canvas id="pagesChart"></canvas>
  </div>

  <div class="stats-container">
    <div class="stat-box">
      <h3>Total Visits</h3>
      <div id="totalVisits">Loading...</div>
    </div>
    <div class="stat-box">
      <h3>Today's Visits</h3>
      <div id="todayVisits">Loading...</div>
    </div>
  </div>
</div>

<style>
.analytics-dashboard {
  padding: 20px;
}

.chart-container {
  margin-bottom: 30px;
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stats-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.stat-box {
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  text-align: center;
}

.stat-box h3 {
  margin: 0 0 10px 0;
  color: #333;
}

canvas {
  max-height: 400px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 访问者趋势图
  const visitorsCtx = document.getElementById('visitorsChart').getContext('2d');
  const visitorsChart = new Chart(visitorsCtx, {
    type: 'line',
    data: {
      labels: [], // 将由API数据填充
      datasets: [{
        label: 'Daily Visitors',
        data: [], // 将由API数据填充
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });

  // 页面访问统计图
  const pagesCtx = document.getElementById('pagesChart').getContext('2d');
  const pagesChart = new Chart(pagesCtx, {
    type: 'bar',
    data: {
      labels: [], // 将由API数据填充
      datasets: [{
        label: 'Page Views',
        data: [], // 将由API数据填充
        backgroundColor: 'rgba(54, 162, 235, 0.5)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });

  // 从GoatCounter API获取数据
  async function fetchAnalytics() {
    try {
      const response = await fetch('https://1124.goatcounter.com/api/v0/stats/hits?period=day');
      const data = await response.json();
      
      // 更新图表数据
      updateCharts(data);
      
      // 更新统计数字
      document.getElementById('totalVisits').textContent = data.total || '0';
      document.getElementById('todayVisits').textContent = data.today || '0';
    } catch (error) {
      console.error('Error fetching analytics:', error);
    }
  }

  function updateCharts(data) {
    // 这里添加处理数据和更新图表的逻辑
    // 示例数据处理方式，需要根据实际API返回的数据结构调整
    if (data.visits) {
      visitorsChart.data.labels = data.visits.map(v => v.date);
      visitorsChart.data.datasets[0].data = data.visits.map(v => v.count);
      visitorsChart.update();
    }

    if (data.pages) {
      pagesChart.data.labels = data.pages.map(p => p.path);
      pagesChart.data.datasets[0].data = data.pages.map(p => p.count);
      pagesChart.update();
    }
  }

  // 初始加载
  fetchAnalytics();
  
  // 每5分钟更新一次数据
  setInterval(fetchAnalytics, 5 * 60 * 1000);
});
</script> 